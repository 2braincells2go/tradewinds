<form method="post" action="/admin/menu/add">
    <label>Name</label> <input name="name" class="tw-admin-menu-name" type="text" />

    <div class="clearout"></div>

    <a class="tw-admin-menu-item-add">+</a>

    <div class="clearout"></div>

    <ul class="tw-admin-menu-sorter"></ul>

    <div class="clearout"></div>

    <input name="_csrf" type="hidden" value="{{ csrftoken }}" />

    <a class="tw-admin-menu-save" class="tw-button-medium tw-button-black-flat">Save Menu</a>

</form>

<script type="text/javascript">

    (function($){

        $(document).ready(function(){

            $('.tw-admin-menu-sorter').sortable();

            function addMenuItemEvents(){
                $('.tw-admin-menu-item-remove').on('click',function(e){
                    e.preventDefault();
                    $(this).parent().remove();
                });
            }

            $('.tw-admin-menu-item-add').on('click',function(e){
                e.preventDefault();
                $('.tw-admin-menu-sorter').append('<li class="tw-admin-menu-item"><a class="tw-admin-menu-item-remove">(-)</a><label>Label:</label><input class="tw-admin-menu-item-label" type="text" /> <label>URL:</label> <input class="tw-admin-menu-item-url" type="text" /></li>');
                addMenuItemEvents();
            });

            $('.tw-admin-menu-save').on('click', function(e){

                var menuObject = {};
                menuObject.name = $('.tw-admin-menu-name').val();
                var menuArray = [];

                $('.tw-admin-menu-sorter li').each(function(){

                    var menuItem = {};
                    menuItem.label = $(this).find('.tw-admin-menu-item-label').val();
                    menuItem.url = $(this).find('.tw-admin-menu-item-url').val();
                    menuArray.push(menuItem);
                });

                menuObject.menu = menuArray;

                $.ajax({
                    url: '/admin/menu/add',
                    beforeSend: function (request) {
                        request.setRequestHeader("x-csrf-token", '{{ csrftoken }}');
                    },
                    dataType: 'json',
                    contentType: 'application/json; charset=UTF-8',
                    data: JSON.stringify(menuObject),
                    type: 'POST',
                    xhrFields: {withCredentials: true}, // required for authenticating session in AJAX request
                    success: function(data, textStatus, jqXHR){
                        alert('Menu Saved');
                        window.location = '/admin/menu/edit/' + data.id;
                    },
                    error: function(){
                        alert('There was an error saving the menu');
                    }
                });

            });

        });

    })(jQuery);

</script>