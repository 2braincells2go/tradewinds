<form method="post" action="/admin/menu/add">
    <label>Name</label> <input name="name" class="tw-admin-menu-name" type="text" value="{{ menuData.name }}" />

    <div class="clearout"></div>

    <a class="tw-admin-menu-item-add tw-button-medium tw-button-black-flat">+ Add</a>

    <div class="clearout"></div>

    <ul class="tw-admin-menu-sorter"></ul>

    <div class="clearout"></div>

    <input name="_csrf" type="hidden" value="{{ csrftoken }}" />

    <a class="tw-admin-menu-save tw-button-medium tw-button-black-flat">Save Menu</a>

</form>

<script type="text/javascript">

    (function($){

         $(document).ready(function(){

            var menuData = {{{ menuData.data }}};

            // populate menu sorter
            for(var i=0; i < menuData.length; i++) {
                
                var checked = "";
                if(menuData[i].newWindow) {
                    checked = "checked";
                }
                $('.tw-admin-menu-sorter').append('<li class="tw-admin-menu-item"><a class="tw-admin-menu-item-remove tw-button-medium tw-button-black-flat">(-) Remove</a><label>Label:</label><input class="tw-admin-menu-item-label" type="text" value="'+menuData[i].label+'" /> <label>URL:</label> <input class="tw-admin-menu-item-url" type="text" value="'+menuData[i].url+'" /><label>New Window:</label> <input class="tw-admin-menu-item-new-window" type="checkbox" '+checked+' /></li>');
            }
            $('.tw-admin-menu-sorter').sortable();
            Tradewinds.Admin.AddMenuItemEvents();

            $('.tw-admin-menu-item-add').on('click',function(e){
                e.preventDefault();
                $('.tw-admin-menu-sorter').append('<li class="tw-admin-menu-item"><a class="tw-admin-menu-item-remove tw-button-medium tw-button-black-flat">(-) Remove</a><label>Label:</label><input class="tw-admin-menu-item-label" type="text" /><label>URL:</label><input class="tw-admin-menu-item-url" type="text" /><label>New Window:</label> <input class="tw-admin-menu-item-new-window" type="checkbox" /></li>');
                Tradewinds.Admin.AddMenuItemEvents();
            });

            $('.tw-admin-menu-save').on('click', function(e){

                var menuObject = {};
                menuObject.name = $('.tw-admin-menu-name').val();
                var menuArray = [];

                $('.tw-admin-menu-sorter li').each(function(){
                    var menuItem = {};
                    menuItem.label = $(this).find('.tw-admin-menu-item-label').val();
                    menuItem.url = $(this).find('.tw-admin-menu-item-url').val();
                    menuItem.newWindow = $(this).find('.tw-admin-menu-item-new-window').is(':checked');
                    menuArray.push(menuItem);
                });

                menuObject.id = "{{ menuData.id }}";
                menuObject.menu = menuArray;
                Tradewinds.Admin.SaveMenu(menuObject, '{{ csrftoken }}', '/admin/menu/edit', false);
            });

        });   

    })(jQuery);

</script>